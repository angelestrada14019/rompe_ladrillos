(()=>{"use strict";var t=function(){function t(){this.x=0,this.y=0,this.dx=3,this.dy=3,this.r=0,this.color="blue"}return t.prototype.init=function(t){this.resize(),this.x=window.innerWidth/2,this.y=window.innerHeight/2},t.prototype.resize=function(){this.r=window.innerWidth/50},t.prototype.checkBounds=function(t){var i=this.x-this.r,e=this.x+this.r,n=this.y-this.r,s=this.y+this.r;return i<=0&&(this.dx=-this.dx),e>=t.width&&(this.dx=-this.dx),n<=0&&(this.dy=-this.dy),!(s>=t.height)},t.prototype.paint=function(t){var i=t.context;return i.fillStyle=this.color,i.beginPath(),i.arc(this.x,this.y,this.r,0,2*Math.PI),i.fill(),i.closePath(),this.move(t)},t.prototype.invertDeltaY=function(){this.dy=-this.dy},t.prototype.invertDeltaX=function(){this.dx=-this.dx},t.prototype.detectPaddleCollision=function(t){if(this.dy<0)return!1;var i=this.x,e=this.x,n=this.y+this.r,s=t.getPosX(),o=t.getPosX()+t.getWidth(),h=t.getPosY(),r=n>h&&n<=h+t.getHeight()&&i>=s&&e<=o;if(r){console.log("collision");var c=i-(s+t.getWidth()/2),l=(c/=t.getWidth()/2)*(Math.PI/3);this.dx=4*Math.sin(l),this.dy=-4*Math.cos(l)}return r},t.prototype.hitsBrick=function(t){return this.bottomBrickCollision(t)?(this.invertDeltaY(),!0):this.topBrickCollision(t)?(this.invertDeltaY(),!1):(this.leftBrickCollision(t)||!!this.rightBrickCollision(t))&&(this.invertDeltaX(),!0)},t.prototype.move=function(t){return this.x+=this.dx,this.y+=this.dy,this.checkBounds(t)},t.prototype.bottomBrickCollision=function(t){var i=t.getPosY()+t.getHeight(),e=t.getPosX(),n=t.getPosX()+t.getWidth(),s=this.y-this.r;return this.x>=e&&this.x<=n&&s<=i&&this.dy<0},t.prototype.topBrickCollision=function(t){var i=t.getPosY(),e=t.getPosX(),n=t.getPosX()+t.getWidth(),s=t.getPosY()+t.getHeight(),o=this.y+this.r,h=this.y-this.r;return this.x+this.r>e&&this.x-this.r<n&&o>i&&h<=s&&this.dy>0},t.prototype.leftBrickCollision=function(t){var i=t.getPosY(),e=t.getPosX(),n=t.getPosX()+t.getWidth(),s=t.getPosY()+t.getHeight(),o=this.y+this.r,h=this.y-this.r;return this.x+this.r>e&&this.x-this.r<n&&o>i&&h<=s&&this.dx>0},t.prototype.rightBrickCollision=function(t){var i=t.getPosY(),e=t.getPosX(),n=t.getPosX()+t.getWidth(),s=t.getPosY()+t.getHeight(),o=this.y+this.r,h=this.y-this.r;return this.x+this.r>e&&this.x-this.r<n&&o>i&&h<=s&&this.dx<0},t}(),i=function(){function t(){}return t.prototype.init=function(){this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas),this.canvas.style.backgroundColor="#f0db4f",this.ctx=this.canvas.getContext("2d"),this.resize()},t.prototype.clear=function(t){t.fillStyle=this.canvas.style.backgroundColor,t.fillRect(0,0,this.canvas.width,this.canvas.height)},Object.defineProperty(t.prototype,"context",{get:function(){return this.ctx},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.canvas.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.canvas.height},enumerable:!1,configurable:!0}),t.prototype.resize=function(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight},t}(),e=function(){function t(){this.w=0,this.h=0,this.x=0,this.y=0,this.color="green"}return t.prototype.init=function(){this.resize()},t.prototype.resize=function(){this.w=window.innerWidth/8,this.h=this.w/5,this.x=(window.innerWidth-this.w)/2,this.y=window.innerHeight-this.h},t.prototype.checkBounds=function(t){var i=this.x,e=this.x+this.w;i<=0&&(this.x=0),e>=t&&(this.x=t-this.w)},t.prototype.move=function(t,i){this.x+=t,this.checkBounds(i)},t.prototype.paint=function(t){t.fillStyle=this.color,t.fillRect(this.x,this.y,this.w,this.h)},t.prototype.getWidth=function(){return this.w},t.prototype.getHeight=function(){return this.h},t.prototype.getPosX=function(){return this.x},t.prototype.getPosY=function(){return this.y},t}(),n=function(){function t(){this.name="Jugador",this.points=0,this.lives=3}return t.prototype.init=function(){var t=window.prompt("Ingresa tu nombre:",this.name);null!=t&&t.length>0&&(this.name=t),document.title=this.name},t.prototype.incPoints=function(t){this.points+=t},t.prototype.getPoints=function(){return this.points},t.prototype.decLives=function(){this.lives--},t.prototype.numLives=function(){return this.lives},t.prototype.getName=function(){return this.name},t}(),s=function(){function t(t,i){this.row=t,this.col=i,this.color="orangered",this._visible=!0}return t.prototype.resize=function(){this.width=(window.innerWidth-(o.BRICKS_PER_ROW-1)*o.GAP)/o.BRICKS_PER_ROW,this.height=this.width/4},t.prototype.paint=function(t){if(this.visible){var i=this.col*(this.width+o.GAP),e=this.row*(this.height+o.GAP);t.fillStyle=this.color,t.fillRect(i,e,this.width,this.height)}},t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t.prototype.getPosX=function(){return this.col*(this.width+o.GAP)},t.prototype.getPosY=function(){return this.row*(this.height+o.GAP)},Object.defineProperty(t.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible=t},enumerable:!1,configurable:!0}),t}(),o=function(){function t(){this.bricks=[]}return t.prototype.init=function(){for(var i=0;i<t.NUM_ROWS;i++)for(var e=0;e<t.BRICKS_PER_ROW;e++)this.bricks.push(new s(i,e));this.resize()},t.prototype.getBricks=function(){return this.bricks},t.prototype.paint=function(t){this.bricks.forEach((function(i){return i.paint(t)}))},t.prototype.resize=function(){this.bricks.forEach((function(t){return t.resize()}))},t.prototype.detectBallCollision=function(t){var i=0;return this.bricks.forEach((function(e){e.visible&&t.hitsBrick(e)&&(e.visible=!1,i++)})),i},t.BRICKS_PER_ROW=5,t.NUM_ROWS=3,t.GAP=5,t}();(function(){function s(s){this._version=s,this.canvas=new i,this.wall=new o,this.ball=new t,this.paddle=new e,this.player=new n}return s.getInstance=function(){return s.instance},s.prototype.init=function(){this.canvas.init(),this.wall.init(),this.paddle.init(),this.ball.init(this.paddle),this.player.init(),window.onresize=this.resize.bind(this),window.onkeydown=this.keydown.bind(this),this.paint()},s.prototype.paint=function(){if(0!=this.player.numLives()){if(this.player.getPoints()==this.wall.getBricks().length)return document.title=" YOU WIN ["+this.player.getPoints()+" POINTS]",void window.alert("YOU WIN!");if(!this.paused){var t=this.canvas.context;t&&(this.canvas.clear(t),this.wall.paint(t),this.paddle.paint(t),this.ball.paint(this.canvas)?this.detectCollisions():(this.player.decLives(),this.ball.init(this.paddle),this.paused=!0),window.requestAnimationFrame(this.paint.bind(this)))}}else document.title="GAME OVER ["+this.player.getPoints()+" POINTS]"},Object.defineProperty(s.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),s.prototype.resize=function(){this.canvas.resize(),this.wall.resize(),this.ball.resize(),this.paddle.resize()},s.prototype.detectBallWallCollision=function(){var t=this.wall.detectBallCollision(this.ball);this.player.incPoints(t),document.title=this.player.getName()+" ["+this.player.getPoints()+" POINTS]"},s.prototype.detectCollisions=function(){this.ball.detectPaddleCollision(this.paddle)||this.detectBallWallCollision()},s.prototype.keydown=function(t){t.preventDefault(),"Space"==t.code?(this.paused=!this.paused,this.paused||window.requestAnimationFrame(this.paint.bind(this))):"ArrowLeft"==t.code?this.paddle.move(-40,this.canvas.width):"ArrowRight"==t.code&&this.paddle.move(40,this.canvas.width)},s.instance=new s("1.1"),s})().getInstance().init()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVuZGxlLmpzIiwibWFwcGluZ3MiOiJtQkFJQSw4QkFFWSxLQUFBQSxFQUFZLEVBQ1osS0FBQUMsRUFBWSxFQUNaLEtBQUFDLEdBQWEsRUFDYixLQUFBQyxHQUFhLEVBQ2IsS0FBQUMsRUFBWSxFQUVaLEtBQUFDLE1BQWdCLE9BdU01QixPQXJNSSxZQUFBQyxLQUFBLFNBQUtDLEdBQ0RDLEtBQUtDLFNBQ0xELEtBQUtSLEVBQUlVLE9BQU9DLFdBQVcsRUFDM0JILEtBQUtQLEVBQUlTLE9BQU9FLFlBQVksR0FHaEMsWUFBQUgsT0FBQSxXQUNJRCxLQUFLSixFQUFJTSxPQUFPQyxXQUFhLElBR2pDLFlBQUFFLFlBQUEsU0FDSUMsR0FFQSxJQUFNQyxFQUFTUCxLQUFLUixFQUFJUSxLQUFLSixFQUN2QlksRUFBU1IsS0FBS1IsRUFBSVEsS0FBS0osRUFDdkJhLEVBQVNULEtBQUtQLEVBQUlPLEtBQUtKLEVBQ3ZCYyxFQUFTVixLQUFLUCxFQUFJTyxLQUFLSixFQU03QixPQUpLVyxHQUFRLElBQWdCUCxLQUFLTixJQUFNTSxLQUFLTixJQUN4Q2MsR0FBU0YsRUFBT0ssUUFBUVgsS0FBS04sSUFBTU0sS0FBS04sSUFDeENlLEdBQU8sSUFBaUJULEtBQUtMLElBQU1LLEtBQUtMLE1BRXhDZSxHQUFVSixFQUFPTSxTQU8xQixZQUFBQyxNQUFBLFNBQ0lQLEdBRUEsSUFBTVEsRUFBZ0NSLEVBQU9TLFFBZTdDLE9BYkFELEVBQUlFLFVBQVloQixLQUFLSCxNQUVyQmlCLEVBQUlHLFlBQ0pILEVBQUlJLElBQ0FsQixLQUFLUixFQUNMUSxLQUFLUCxFQUNMTyxLQUFLSixFQUNMLEVBQ0EsRUFBSXVCLEtBQUtDLElBRWJOLEVBQUlPLE9BQ0pQLEVBQUlRLFlBRUd0QixLQUFLdUIsS0FDUmpCLElBSVIsWUFBQWtCLGFBQUEsV0FDSXhCLEtBQUtMLElBQU1LLEtBQUtMLElBRXBCLFlBQUE4QixhQUFBLFdBQ0l6QixLQUFLTixJQUFNTSxLQUFLTixJQUdwQixZQUFBZ0Msc0JBQUEsU0FDSTNCLEdBRUEsR0FBS0MsS0FBS0wsR0FBSyxFQUVYLE9BQU8sRUFHWCxJQUFNZ0MsRUFBYTNCLEtBQUtSLEVBQ2xCb0MsRUFBYTVCLEtBQUtSLEVBQ2xCcUMsRUFBYTdCLEtBQUtQLEVBQUlPLEtBQUtKLEVBRTNCa0MsRUFBYy9CLEVBQU9nQyxVQUNyQkMsRUFBY2pDLEVBQU9nQyxVQUFZaEMsRUFBT2tDLFdBQ3hDQyxFQUFjbkMsRUFBT29DLFVBRXJCQyxFQUFZUCxFQUFhSyxHQUN4QkwsR0FBZUssRUFBWW5DLEVBQU9zQyxhQUNsQ1YsR0FBWUcsR0FDWkYsR0FBYUksRUFFcEIsR0FBS0ksRUFBWSxDQUNiRSxRQUFRQyxJQUFLLGFBRWIsSUFBSUMsRUFBb0JiLEdBQVlHLEVBQWEvQixFQUFPa0MsV0FBVyxHQUUvRFEsR0FESkQsR0FBMkN6QyxFQUFPa0MsV0FBVyxJQUM5QmQsS0FBS0MsR0FBRyxHQUN2Q3BCLEtBQUtOLEdBQUcsRUFBRXlCLEtBQUt1QixJQUFJRCxHQUNuQnpDLEtBQUtMLElBQUksRUFBRXdCLEtBQUt3QixJQUFJRixHQUl4QixPQUFPTCxHQUdYLFlBQUFRLFVBQUEsU0FDSUMsR0FFQSxPQUFLN0MsS0FBSzhDLHFCQUFzQkQsSUFDNUI3QyxLQUFLd0IsZ0JBQ0UsR0FHTnhCLEtBQUsrQyxrQkFBbUJGLElBRXpCN0MsS0FBS3dCLGdCQUNFLElBRU54QixLQUFLZ0QsbUJBQW9CSCxNQUl6QjdDLEtBQUtpRCxvQkFBcUJKLE1BSDNCN0MsS0FBS3lCLGdCQUNFLElBWVAsWUFBQUYsS0FBUixTQUNJakIsR0FLQSxPQUhBTixLQUFLUixHQUFLUSxLQUFLTixHQUNmTSxLQUFLUCxHQUFLTyxLQUFLTCxHQUVSSyxLQUFLSyxZQUNSQyxJQUlBLFlBQUF3QyxxQkFBUixTQUNJRCxHQUVBLElBQU1LLEVBQWNMLEVBQU1WLFVBQVlVLEVBQU1SLFlBQ3RDYyxFQUFjTixFQUFNZCxVQUNwQnFCLEVBQWNQLEVBQU1kLFVBQVljLEVBQU1aLFdBRXRDb0IsRUFBVXJELEtBQUtQLEVBQUlPLEtBQUtKLEVBRTlCLE9BQU9JLEtBQUtSLEdBQUsyRCxHQUNWbkQsS0FBS1IsR0FBSzRELEdBQ1ZDLEdBQVdILEdBQ1hsRCxLQUFLTCxHQUFLLEdBRWIsWUFBQW9ELGtCQUFSLFNBQ0lGLEdBRUEsSUFBTVMsRUFBV1QsRUFBTVYsVUFDakJnQixFQUFjTixFQUFNZCxVQUNwQnFCLEVBQWNQLEVBQU1kLFVBQVljLEVBQU1aLFdBQ3RDaUIsRUFBY0wsRUFBTVYsVUFBWVUsRUFBTVIsWUFFdENrQixFQUFhdkQsS0FBS1AsRUFBSU8sS0FBS0osRUFDM0J5RCxFQUFVckQsS0FBS1AsRUFBSU8sS0FBS0osRUFFOUIsT0FBUUksS0FBS1IsRUFBSVEsS0FBS0osRUFBS3VELEdBQ25CbkQsS0FBS1IsRUFBSVEsS0FBS0osRUFBS3dELEdBQ3BCRyxFQUFhRCxHQUNiRCxHQUFXSCxHQUNYbEQsS0FBS0wsR0FBSyxHQUViLFlBQUFxRCxtQkFBUixTQUNJSCxHQUVJLElBQU1TLEVBQVdULEVBQU1WLFVBQ2pCZ0IsRUFBY04sRUFBTWQsVUFDcEJxQixFQUFjUCxFQUFNZCxVQUFZYyxFQUFNWixXQUN0Q2lCLEVBQWNMLEVBQU1WLFVBQVlVLEVBQU1SLFlBRXRDa0IsRUFBYXZELEtBQUtQLEVBQUlPLEtBQUtKLEVBQzNCeUQsRUFBVXJELEtBQUtQLEVBQUlPLEtBQUtKLEVBRTlCLE9BQVFJLEtBQUtSLEVBQUlRLEtBQUtKLEVBQUt1RCxHQUNuQm5ELEtBQUtSLEVBQUlRLEtBQUtKLEVBQUt3RCxHQUNwQkcsRUFBYUQsR0FDYkQsR0FBV0gsR0FDWGxELEtBQUtOLEdBQUssR0FFakIsWUFBQXVELG9CQUFSLFNBQ0lKLEdBRUksSUFBTVMsRUFBV1QsRUFBTVYsVUFDakJnQixFQUFjTixFQUFNZCxVQUNwQnFCLEVBQWNQLEVBQU1kLFVBQVljLEVBQU1aLFdBQ3RDaUIsRUFBY0wsRUFBTVYsVUFBWVUsRUFBTVIsWUFFdENrQixFQUFhdkQsS0FBS1AsRUFBSU8sS0FBS0osRUFDM0J5RCxFQUFVckQsS0FBS1AsRUFBSU8sS0FBS0osRUFFOUIsT0FBUUksS0FBS1IsRUFBSVEsS0FBS0osRUFBS3VELEdBQ25CbkQsS0FBS1IsRUFBSVEsS0FBS0osRUFBS3dELEdBQ3BCRyxFQUFhRCxHQUNiRCxHQUFXSCxHQUNYbEQsS0FBS04sR0FBSyxHQUU3QixFQS9NQSxHQ0pBLDJCQW9EQSxPQS9DSSxZQUFBSSxLQUFBLFdBQ0lFLEtBQUtNLE9BQVNrRCxTQUFTQyxjQUNuQixVQUVKRCxTQUFTRSxLQUFLQyxZQUNWM0QsS0FBS00sUUFHVE4sS0FBS00sT0FDQXNELE1BQ0FDLGdCQUFrQixVQUV2QjdELEtBQUtjLElBQU1kLEtBQUtNLE9BQU93RCxXQUNuQixNQUdKOUQsS0FBS0MsVUFHVCxZQUFBOEQsTUFBQSxTQUNJakQsR0FFQUEsRUFBSUUsVUFBWWhCLEtBQUtNLE9BQU9zRCxNQUFNQyxnQkFDbEMvQyxFQUFJa0QsU0FDQSxFQUNBLEVBQ0FoRSxLQUFLTSxPQUFPSyxNQUNaWCxLQUFLTSxPQUFPTSxTQUlwQixzQkFBSSxzQkFBTyxDLElBQVgsV0FDSSxPQUFPWixLQUFLYyxLLGdDQUdoQixzQkFBSSxvQkFBSyxDLElBQVQsV0FDSSxPQUFPZCxLQUFLTSxPQUFPSyxPLGdDQUd2QixzQkFBSSxxQkFBTSxDLElBQVYsV0FDSSxPQUFPWCxLQUFLTSxPQUFPTSxRLGdDQUd2QixZQUFBWCxPQUFBLFdBQ0lELEtBQUtNLE9BQU9LLE1BQVFULE9BQU9DLFdBQzNCSCxLQUFLTSxPQUFPTSxPQUFTVixPQUFPRSxhQUVwQyxFQXBEQSxHQ0FBLDBCQUNZLEtBQUE2RCxFQUFZLEVBQ1osS0FBQUMsRUFBWSxFQUNaLEtBQUExRSxFQUFZLEVBQ1osS0FBQUMsRUFBWSxFQUVaLEtBQUFJLE1BQVEsUUF1RHBCLE9BckRJLFlBQUFDLEtBQUEsV0FDSUUsS0FBS0MsVUFHVCxZQUFBQSxPQUFBLFdBQ0lELEtBQUtpRSxFQUFJL0QsT0FBT0MsV0FBYSxFQUM3QkgsS0FBS2tFLEVBQUlsRSxLQUFLaUUsRUFBSSxFQUVsQmpFLEtBQUtSLEdBQUtVLE9BQU9DLFdBQWFILEtBQUtpRSxHQUFLLEVBQ3hDakUsS0FBS1AsRUFBS1MsT0FBT0UsWUFBY0osS0FBS2tFLEdBR3hDLFlBQUE3RCxZQUFBLFNBQ0k4RCxHQUVBLElBQU01RCxFQUFTUCxLQUFLUixFQUNkZ0IsRUFBU1IsS0FBS1IsRUFBSVEsS0FBS2lFLEVBRXhCMUQsR0FBUSxJQUFnQlAsS0FBS1IsRUFBSSxHQUNqQ2dCLEdBQVMyRCxJQUFNbkUsS0FBS1IsRUFBSTJFLEVBQU1uRSxLQUFLaUUsSUFHNUMsWUFBQTFDLEtBQUEsU0FDSTdCLEVBQ0F5RSxHQUVBbkUsS0FBS1IsR0FBS0UsRUFDVk0sS0FBS0ssWUFDRDhELElBSVIsWUFBQXRELE1BQUEsU0FDSUMsR0FFQUEsRUFBSUUsVUFBWWhCLEtBQUtILE1BQ3JCaUIsRUFBSWtELFNBQVVoRSxLQUFLUixFQUFHUSxLQUFLUCxFQUFHTyxLQUFLaUUsRUFBR2pFLEtBQUtrRSxJQUcvQyxZQUFBakMsU0FBQSxXQUNJLE9BQU9qQyxLQUFLaUUsR0FFaEIsWUFBQTVCLFVBQUEsV0FDSSxPQUFPckMsS0FBS2tFLEdBR2hCLFlBQUFuQyxRQUFBLFdBQ0ksT0FBTy9CLEtBQUtSLEdBR2hCLFlBQUEyQyxRQUFBLFdBQ0ksT0FBT25DLEtBQUtQLEdBRXBCLEVBN0RBLEdDQUEsMEJBRVksS0FBQTJFLEtBQWUsVUFDZixLQUFBQyxPQUFpQixFQUNqQixLQUFBQyxNQUFnQixFQW9DNUIsT0FsQ0ksWUFBQXhFLEtBQUEsV0FDSSxJQUFNeUUsRUFBbUJyRSxPQUFPc0UsT0FDNUIscUJBQ0F4RSxLQUFLb0UsTUFHUSxNQUFaRyxHQUFvQkEsRUFBU0UsT0FBUyxJQUN2Q3pFLEtBQUtvRSxLQUFPRyxHQUdoQmYsU0FBU2tCLE1BQVExRSxLQUFLb0UsTUFHMUIsWUFBQU8sVUFBQSxTQUNJQyxHQUVBNUUsS0FBS3FFLFFBQVVPLEdBR25CLFlBQUFDLFVBQUEsV0FDSSxPQUFPN0UsS0FBS3FFLFFBR2hCLFlBQUFTLFNBQUEsV0FDSTlFLEtBQUtzRSxTQUdULFlBQUFTLFNBQUEsV0FDSSxPQUFPL0UsS0FBS3NFLE9BR2hCLFlBQUFVLFFBQUEsV0FDSSxPQUFPaEYsS0FBS29FLE1BRXBCLEVBeENBLEdDRUEsYUFRSSxXQUNZYSxFQUNBQyxHQURBLEtBQUFELElBQUFBLEVBQ0EsS0FBQUMsSUFBQUEsRUFMSixLQUFBckYsTUFBZ0IsWUFDaEIsS0FBQXNGLFVBQW9CLEVBcURoQyxPQTlDSSxZQUFBbEYsT0FBQSxXQUNJRCxLQUFLVyxPQUFTVCxPQUFPQyxZQUNkaUYsRUFBS0MsZUFBaUIsR0FBS0QsRUFBS0UsS0FBT0YsRUFBS0MsZUFDbkRyRixLQUFLWSxPQUFTWixLQUFLVyxNQUFRLEdBRy9CLFlBQUFFLE1BQUEsU0FDSUMsR0FFQSxHQUFLZCxLQUFLdUYsUUFBVSxDQUNoQixJQUFNL0YsRUFBSVEsS0FBS2tGLEtBQU9sRixLQUFLVyxNQUFReUUsRUFBS0UsS0FDbEM3RixFQUFJTyxLQUFLaUYsS0FBT2pGLEtBQUtZLE9BQVN3RSxFQUFLRSxLQUV6Q3hFLEVBQUlFLFVBQVloQixLQUFLSCxNQUNyQmlCLEVBQUlrRCxTQUFVeEUsRUFBR0MsRUFBR08sS0FBS1csTUFBT1gsS0FBS1ksVUFPN0MsWUFBQXFCLFNBQUEsV0FDSSxPQUFPakMsS0FBS1csT0FHaEIsWUFBQTBCLFVBQUEsV0FDSSxPQUFPckMsS0FBS1ksUUFHaEIsWUFBQW1CLFFBQUEsV0FDSSxPQUFPL0IsS0FBS2tGLEtBQU9sRixLQUFLVyxNQUFReUUsRUFBS0UsTUFHekMsWUFBQW5ELFFBQUEsV0FDSSxPQUFPbkMsS0FBS2lGLEtBQU9qRixLQUFLWSxPQUFTd0UsRUFBS0UsTUFHMUMsc0JBQUksc0JBQU8sQyxJQUFYLFdBQ0ksT0FBT3RGLEtBQUttRixVLElBR2hCLFNBQ0lLLEdBRUF4RixLQUFLbUYsU0FBV0ssRyxnQ0FFeEIsRUEzREEsR0NDQSxhQU9JLGFBQ0l4RixLQUFLeUYsT0FBUyxHQWtEdEIsT0EvQ0ksWUFBQTNGLEtBQUEsV0FDSSxJQUFNLElBQUltRixFQUFjLEVBQUdBLEVBQU1HLEVBQUtNLFNBQVVULElBQzVDLElBQU0sSUFBSUMsRUFBYyxFQUFHQSxFQUFNRSxFQUFLQyxlQUFnQkgsSUFDbERsRixLQUFLeUYsT0FBT0UsS0FDUixJQUFJQyxFQUFPWCxFQUFLQyxJQU01QmxGLEtBQUtDLFVBRUYsWUFBQTRGLFVBQVAsV0FDSSxPQUFPN0YsS0FBS3lGLFFBR2hCLFlBQUE1RSxNQUFBLFNBQ0lDLEdBRUFkLEtBQUt5RixPQUNBSyxTQUFTLFNBQUNqRCxHQUFVLE9BQUFBLEVBQU1oQyxNQUFPQyxPQUcxQyxZQUFBYixPQUFBLFdBQ0lELEtBQUt5RixPQUNBSyxTQUFTLFNBQUNqRCxHQUFVLE9BQUFBLEVBQU01QyxhQUduQyxZQUFBOEYsb0JBQUEsU0FDSUMsR0FFQSxJQUFJQyxFQUFhLEVBY2pCLE9BWkFqRyxLQUFLeUYsT0FBT0ssU0FBUyxTQUFDakQsR0FDYkEsRUFBTTBDLFNBQ0ZTLEVBQUtwRCxVQUFXQyxLQUNqQkEsRUFBTTBDLFNBQVUsRUFDaEJVLFFBUUxBLEdBdkRLLEVBQUFaLGVBQXlCLEVBQ3pCLEVBQUFLLFNBQW1CLEVBQ25CLEVBQUFKLElBQWMsRUF1RGxDLEVBMURBLElDSUEsV0FrQkksV0FDWVksR0FBQSxLQUFBQSxTQUFBQSxFQUVSbEcsS0FBS00sT0FBUyxJQUFJNkYsRUFDbEJuRyxLQUFLb0csS0FBUyxJQUFJaEIsRUFDbEJwRixLQUFLZ0csS0FBUyxJQUFJSyxFQUNsQnJHLEtBQUtELE9BQVMsSUFBSXVHLEVBQ2xCdEcsS0FBS3VHLE9BQVMsSUFBSUMsRUEwSTFCLE9BckpXLEVBQUFDLFlBQVAsV0FDSSxPQUFPQyxFQUFLQyxVQWFoQixZQUFBN0csS0FBQSxXQUNJRSxLQUFLTSxPQUFPUixPQUNaRSxLQUFLb0csS0FBS3RHLE9BQ1ZFLEtBQUtELE9BQU9ELE9BQ1pFLEtBQUtnRyxLQUFLbEcsS0FBS0UsS0FBS0QsUUFDcEJDLEtBQUt1RyxPQUFPekcsT0FFWkksT0FBTzBHLFNBQVc1RyxLQUFLQyxPQUNsQjRHLEtBQ0c3RyxNQUdSRSxPQUFPNEcsVUFBWTlHLEtBQUsrRyxRQUNuQkYsS0FDRzdHLE1BSVJBLEtBQUthLFNBR1QsWUFBQUEsTUFBQSxXQUdJLEdBQStCLEdBQTFCYixLQUFLdUcsT0FBT3hCLFdBQWpCLENBTUEsR0FBSy9FLEtBQUt1RyxPQUFPMUIsYUFBZTdFLEtBQUtvRyxLQUFLUCxZQUFZcEIsT0FLbEQsT0FKQWpCLFNBQVNrQixNQUFRLGFBQ1gxRSxLQUFLdUcsT0FBTzFCLFlBQ1osZ0JBQ04zRSxPQUFPOEcsTUFBTSxZQUlqQixJQUFLaEgsS0FBS2lILE9BQVYsQ0FJQSxJQUFNbkcsRUFBTWQsS0FBS00sT0FBT1MsUUFDbkJELElBQ0RkLEtBQUtNLE9BQU95RCxNQUFPakQsR0FDbkJkLEtBQUtvRyxLQUFLdkYsTUFBT0MsR0FDakJkLEtBQUtELE9BQU9jLE1BQU9DLEdBRWRkLEtBQUtnRyxLQUFLbkYsTUFBT2IsS0FBS00sUUFDdkJOLEtBQUtrSCxvQkFHTGxILEtBQUt1RyxPQUFPekIsV0FDWjlFLEtBQUtnRyxLQUFLbEcsS0FBS0UsS0FBS0QsUUFFcEJDLEtBQUtpSCxRQUFTLEdBR2xCL0csT0FBT2lILHNCQUFzQm5ILEtBQUthLE1BQU1nRyxLQUFLN0csY0FqQzdDd0QsU0FBU2tCLE1BQVEsY0FDWDFFLEtBQUt1RyxPQUFPMUIsWUFDWixZQW9DZCxzQkFBSSxzQkFBTyxDLElBQVgsV0FDSSxPQUFPN0UsS0FBS2tHLFUsZ0NBS1IsWUFBQWpHLE9BQVIsV0FDSUQsS0FBS00sT0FBT0wsU0FDWkQsS0FBS29HLEtBQUtuRyxTQUNWRCxLQUFLZ0csS0FBSy9GLFNBQ1ZELEtBQUtELE9BQU9FLFVBR1IsWUFBQW1ILHdCQUFSLFdBQ0ksSUFBTUMsRUFBWXJILEtBQUtvRyxLQUNsQkwsb0JBQ0cvRixLQUFLZ0csTUFHYmhHLEtBQUt1RyxPQUNBNUIsVUFDRzBDLEdBR1I3RCxTQUFTa0IsTUFBUTFFLEtBQUt1RyxPQUFPdkIsVUFDdkIsS0FDQWhGLEtBQUt1RyxPQUFPMUIsWUFDWixZQUdGLFlBQUFxQyxpQkFBUixXQUNTbEgsS0FBS2dHLEtBQUt0RSxzQkFDWDFCLEtBQUtELFNBS1RDLEtBQUtvSCwyQkFHRCxZQUFBTCxRQUFSLFNBQ0lPLEdBRUFBLEVBQUVDLGlCQUVhLFNBQVZELEVBQUVFLE1BQ0h4SCxLQUFLaUgsUUFBVWpILEtBQUtpSCxPQUVkakgsS0FBS2lILFFBQ1AvRyxPQUFPaUgsc0JBQ0huSCxLQUFLYSxNQUNBZ0csS0FDRzdHLFFBS0EsYUFBVnNILEVBQUVFLEtBQ1J4SCxLQUFLRCxPQUNBd0IsTUFDSSxHQUNEdkIsS0FBS00sT0FBT0ssT0FHSixjQUFWMkcsRUFBRUUsTUFDUnhILEtBQUtELE9BQ0F3QixLQUNHLEdBQ0F2QixLQUFLTSxPQUFPSyxRQXJKSixFQUFBZ0csU0FBaUIsSUFBSUQsRUFDekMsT0F3SlIsR0FuS0EsR0NKS0QsY0FDQTNHLFEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYi8uL3NyYy9iYWxsLnRzIiwid2VicGFjazovL2JiLy4vc3JjL2NhbnZhcy50cyIsIndlYnBhY2s6Ly9iYi8uL3NyYy9wYWRkbGUudHMiLCJ3ZWJwYWNrOi8vYmIvLi9zcmMvcGxheWVyLnRzIiwid2VicGFjazovL2JiLy4vc3JjL2JyaWNrLnRzIiwid2VicGFjazovL2JiLy4vc3JjL3dhbGwudHMiLCJ3ZWJwYWNrOi8vYmIvLi9zcmMvZ2FtZS50cyIsIndlYnBhY2s6Ly9iYi8uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCcmljayB9IGZyb20gJy4vYnJpY2snO1xuaW1wb3J0IHsgQ2FudmFzIH0gZnJvbSAnLi9jYW52YXMnO1xuaW1wb3J0IHsgUGFkZGxlIH0gZnJvbSAnLi9wYWRkbGUnO1xuXG5leHBvcnQgY2xhc3MgQmFsbCB7XG5cbiAgICBwcml2YXRlIHg6IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSB5OiBudW1iZXIgPSAwO1xuICAgIHByaXZhdGUgZHg6IG51bWJlciA9IDM7ICAgICAvLyBzdGFydCBtb3ZpbmcgcmlnaHQgXG4gICAgcHJpdmF0ZSBkeTogbnVtYmVyID0gMzsgICAgIC8vIHN0YXJ0IG1vdmluZyBkb3duXG4gICAgcHJpdmF0ZSByOiBudW1iZXIgPSAwO1xuICAgIFxuICAgIHByaXZhdGUgY29sb3I6IHN0cmluZyA9ICdibHVlJztcblxuICAgIGluaXQocGFkZGxlOlBhZGRsZSk6IHZvaWQge1xuICAgICAgICB0aGlzLnJlc2l6ZSgpO1xuICAgICAgICB0aGlzLnggPSB3aW5kb3cuaW5uZXJXaWR0aC8yOyAgICAgIC8vIE5FV1xuICAgICAgICB0aGlzLnkgPSB3aW5kb3cuaW5uZXJIZWlnaHQvMjsgICAgIC8vIE5FV1xuICAgIH1cblxuICAgIHJlc2l6ZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5yID0gd2luZG93LmlubmVyV2lkdGggLyA1MDtcbiAgICB9O1xuXG4gICAgY2hlY2tCb3VuZHMoXG4gICAgICAgIGNhbnZhczogQ2FudmFzICk6IGJvb2xlYW4ge1xuXG4gICAgICAgIGNvbnN0IGxlZnQgPSAgIHRoaXMueCAtIHRoaXMucjtcbiAgICAgICAgY29uc3QgcmlnaHQgPSAgdGhpcy54ICsgdGhpcy5yO1xuICAgICAgICBjb25zdCB0b3AgPSAgICB0aGlzLnkgLSB0aGlzLnI7XG4gICAgICAgIGNvbnN0IGJvdHRvbSA9IHRoaXMueSArIHRoaXMucjtcblxuICAgICAgICBpZiAoIGxlZnQgPD0gMCApICAgICAgICAgICAgIHRoaXMuZHggPSAtdGhpcy5keDtcbiAgICAgICAgaWYgKCByaWdodCA+PSBjYW52YXMud2lkdGggKSB0aGlzLmR4ID0gLXRoaXMuZHg7XG4gICAgICAgIGlmICggdG9wIDw9IDAgKSAgICAgICAgICAgICAgdGhpcy5keSA9IC10aGlzLmR5O1xuXG4gICAgICAgIGlmICggYm90dG9tID49IGNhbnZhcy5oZWlnaHQgKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuXG4gICAgcGFpbnQoIFxuICAgICAgICBjYW52YXM6IENhbnZhcyApOiBib29sZWFuIHtcblxuICAgICAgICBjb25zdCBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCA9IGNhbnZhcy5jb250ZXh0O1xuXG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSB0aGlzLmNvbG9yO1xuXG4gICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgY3R4LmFyYyggXG4gICAgICAgICAgICB0aGlzLngsXG4gICAgICAgICAgICB0aGlzLnksXG4gICAgICAgICAgICB0aGlzLnIsXG4gICAgICAgICAgICAwLFxuICAgICAgICAgICAgMiAqIE1hdGguUEksXG4gICAgICAgICk7XG4gICAgICAgIGN0eC5maWxsKCk7XG4gICAgICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB0aGlzLm1vdmUoXG4gICAgICAgICAgICBjYW52YXNcbiAgICAgICAgKTtcbiAgICB9O1xuXG4gICAgaW52ZXJ0RGVsdGFZKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmR5ID0gLXRoaXMuZHk7XG4gICAgfVxuICAgIGludmVydERlbHRhWCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5keCA9IC10aGlzLmR4O1xuICAgIH1cblxuICAgIGRldGVjdFBhZGRsZUNvbGxpc2lvbiggXG4gICAgICAgIHBhZGRsZTogUGFkZGxlICk6IGJvb2xlYW4ge1xuXG4gICAgICAgIGlmICggdGhpcy5keSA8IDAgKSB7XG4gICAgICAgICAgICAvLyBnb2luZyB1cFxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgfVxuICAgIFxuICAgICAgICBjb25zdCBiYWxsTGVmdCAgID0gdGhpcy54O1xuICAgICAgICBjb25zdCBiYWxsUmlnaHQgID0gdGhpcy54O1xuICAgICAgICBjb25zdCBiYWxsQm90dG9tID0gdGhpcy55ICsgdGhpcy5yO1xuICAgIFxuICAgICAgICBjb25zdCBwYWRkbGVMZWZ0ICA9IHBhZGRsZS5nZXRQb3NYKCk7XG4gICAgICAgIGNvbnN0IHBhZGRsZVJpZ2h0ID0gcGFkZGxlLmdldFBvc1goKSArIHBhZGRsZS5nZXRXaWR0aCgpO1xuICAgICAgICBjb25zdCBwYWRkbGVUb3AgICA9IHBhZGRsZS5nZXRQb3NZKCk7XG4gICAgXG4gICAgICAgIGNvbnN0IGNvbGxpc2lvbiA9IGJhbGxCb3R0b20gPiBwYWRkbGVUb3BcbiAgICAgICAgICAgICYmIGJhbGxCb3R0b20gPD0gKHBhZGRsZVRvcCArIHBhZGRsZS5nZXRIZWlnaHQoKSlcbiAgICAgICAgICAgICYmIGJhbGxMZWZ0ID49IHBhZGRsZUxlZnRcbiAgICAgICAgICAgICYmIGJhbGxSaWdodCA8PSBwYWRkbGVSaWdodDtcblxuICAgICAgICBpZiAoIGNvbGxpc2lvbiApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnY29sbGlzaW9uJyApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBsZXQgcHVudG9Hb2xwZUVuUGFkZGxlPSBiYWxsTGVmdCAtIChwYWRkbGVMZWZ0ICsgcGFkZGxlLmdldFdpZHRoKCkvMik7IFxuICAgICAgICAgICAgcHVudG9Hb2xwZUVuUGFkZGxlID0gcHVudG9Hb2xwZUVuUGFkZGxlIC8gKHBhZGRsZS5nZXRXaWR0aCgpLzIpOy8vZW50cmUgLTEgeSAxXG4gICAgICAgICAgICBsZXQgYW5ndWxvPXB1bnRvR29scGVFblBhZGRsZSooTWF0aC5QSS8zKTsvL211bHRpcGxpY2FyIHBvciA2MCBncmFkb3MgcXVlIHNlcmlhIGVsIG1heGltbyBlbiBsb3MgYm9yZGVzXG4gICAgICAgICAgICB0aGlzLmR4PTQqTWF0aC5zaW4oYW5ndWxvKTtcbiAgICAgICAgICAgIHRoaXMuZHk9LTQqTWF0aC5jb3MoYW5ndWxvKTtcbiAgICAgICAgICAgIFxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNvbGxpc2lvbjtcbiAgICB9XG5cbiAgICBoaXRzQnJpY2soIFxuICAgICAgICBicmljazogQnJpY2sgKTogYm9vbGVhbiB7XG5cbiAgICAgICAgaWYgKCB0aGlzLmJvdHRvbUJyaWNrQ29sbGlzaW9uKCBicmljayApICkge1xuICAgICAgICAgICAgdGhpcy5pbnZlcnREZWx0YVkoKTsgXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBUT0RPXG4gICAgICAgIGlmICggdGhpcy50b3BCcmlja0NvbGxpc2lvbiggYnJpY2sgKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgdGhpcy5pbnZlcnREZWx0YVkoKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgIH1cbiAgICAgICAgaWYgKCB0aGlzLmxlZnRCcmlja0NvbGxpc2lvbiggYnJpY2sgKSApIHtcbiAgICAgICAgICAgIHRoaXMuaW52ZXJ0RGVsdGFYKCk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIHRoaXMucmlnaHRCcmlja0NvbGxpc2lvbiggYnJpY2sgKSApIHtcbiAgICAgICAgICAgIHRoaXMuaW52ZXJ0RGVsdGFYKCk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gcHJpdmF0ZSBtZXRob2RzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgcHJpdmF0ZSBtb3ZlKFxuICAgICAgICBjYW52YXM6IENhbnZhcyApOiBib29sZWFuIHtcblxuICAgICAgICB0aGlzLnggKz0gdGhpcy5keDtcbiAgICAgICAgdGhpcy55ICs9IHRoaXMuZHk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tCb3VuZHMoXG4gICAgICAgICAgICBjYW52YXMgXG4gICAgICAgICk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgYm90dG9tQnJpY2tDb2xsaXNpb24oXG4gICAgICAgIGJyaWNrOiBCcmljayApOiBib29sZWFuIHtcbiAgICBcbiAgICAgICAgY29uc3QgYnJpY2tCb3R0b20gPSBicmljay5nZXRQb3NZKCkgKyBicmljay5nZXRIZWlnaHQoKTtcbiAgICAgICAgY29uc3QgYnJpY2tMZWZ0ICAgPSBicmljay5nZXRQb3NYKCk7XG4gICAgICAgIGNvbnN0IGJyaWNrUmlnaHQgID0gYnJpY2suZ2V0UG9zWCgpICsgYnJpY2suZ2V0V2lkdGgoKTtcblxuICAgICAgICBjb25zdCBiYWxsVG9wID0gdGhpcy55IC0gdGhpcy5yO1xuXG4gICAgICAgIHJldHVybiB0aGlzLnggPj0gYnJpY2tMZWZ0XG4gICAgICAgICAgICAmJiB0aGlzLnggPD0gYnJpY2tSaWdodFxuICAgICAgICAgICAgJiYgYmFsbFRvcCA8PSBicmlja0JvdHRvbVxuICAgICAgICAgICAgJiYgdGhpcy5keSA8IDA7ICAgICAgICAgICAgLy8gYmFsbCBpcyBnb2luZyB1cFxuICAgIH1cbiAgICBwcml2YXRlIHRvcEJyaWNrQ29sbGlzaW9uKCBcbiAgICAgICAgYnJpY2s6IEJyaWNrICk6IGJvb2xlYW4ge1xuXG4gICAgICAgIGNvbnN0IGJyaWNrVG9wID0gYnJpY2suZ2V0UG9zWSgpO1xuICAgICAgICBjb25zdCBicmlja0xlZnQgICA9IGJyaWNrLmdldFBvc1goKTtcbiAgICAgICAgY29uc3QgYnJpY2tSaWdodCAgPSBicmljay5nZXRQb3NYKCkgKyBicmljay5nZXRXaWR0aCgpO1xuICAgICAgICBjb25zdCBicmlja0JvdHRvbSA9IGJyaWNrLmdldFBvc1koKSArIGJyaWNrLmdldEhlaWdodCgpO1xuICAgIFxuICAgICAgICBjb25zdCBiYWxsQm90dG9uID0gdGhpcy55ICsgdGhpcy5yO1xuICAgICAgICBjb25zdCBiYWxsVG9wID0gdGhpcy55IC0gdGhpcy5yO1xuICAgIFxuICAgICAgICByZXR1cm4gKHRoaXMueCArIHRoaXMucikgPiBicmlja0xlZnRcbiAgICAgICAgICAgICYmICh0aGlzLnggLSB0aGlzLnIpIDwgYnJpY2tSaWdodFxuICAgICAgICAgICAgJiYgYmFsbEJvdHRvbiA+IGJyaWNrVG9wXG4gICAgICAgICAgICAmJiBiYWxsVG9wIDw9IGJyaWNrQm90dG9tXG4gICAgICAgICAgICAmJiB0aGlzLmR5ID4gMDsgICAgICAgICAgICAvLyBiYWxsIGlzIGdvaW5nIGRvd25cbiAgICB9XG4gICAgcHJpdmF0ZSBsZWZ0QnJpY2tDb2xsaXNpb24oXG4gICAgICAgIGJyaWNrOiBCcmljayApOiBib29sZWFuIHtcblxuICAgICAgICAgICAgY29uc3QgYnJpY2tUb3AgPSBicmljay5nZXRQb3NZKCk7XG4gICAgICAgICAgICBjb25zdCBicmlja0xlZnQgICA9IGJyaWNrLmdldFBvc1goKTtcbiAgICAgICAgICAgIGNvbnN0IGJyaWNrUmlnaHQgID0gYnJpY2suZ2V0UG9zWCgpICsgYnJpY2suZ2V0V2lkdGgoKTtcbiAgICAgICAgICAgIGNvbnN0IGJyaWNrQm90dG9tID0gYnJpY2suZ2V0UG9zWSgpICsgYnJpY2suZ2V0SGVpZ2h0KCk7XG4gICAgICAgIFxuICAgICAgICAgICAgY29uc3QgYmFsbEJvdHRvbiA9IHRoaXMueSArIHRoaXMucjtcbiAgICAgICAgICAgIGNvbnN0IGJhbGxUb3AgPSB0aGlzLnkgLSB0aGlzLnI7XG4gICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuICh0aGlzLnggKyB0aGlzLnIpID4gYnJpY2tMZWZ0XG4gICAgICAgICAgICAgICAgJiYgKHRoaXMueCAtIHRoaXMucikgPCBicmlja1JpZ2h0XG4gICAgICAgICAgICAgICAgJiYgYmFsbEJvdHRvbiA+IGJyaWNrVG9wXG4gICAgICAgICAgICAgICAgJiYgYmFsbFRvcCA8PSBicmlja0JvdHRvbVxuICAgICAgICAgICAgICAgICYmIHRoaXMuZHggPiAwOyAgICAgICAgICAgICAvLyBiYWxsIGlzIGdvaW5nIHJpZ2h0XG4gICAgfVxuICAgIHByaXZhdGUgcmlnaHRCcmlja0NvbGxpc2lvbihcbiAgICAgICAgYnJpY2s6IEJyaWNrICk6IGJvb2xlYW4ge1xuXG4gICAgICAgICAgICBjb25zdCBicmlja1RvcCA9IGJyaWNrLmdldFBvc1koKTtcbiAgICAgICAgICAgIGNvbnN0IGJyaWNrTGVmdCAgID0gYnJpY2suZ2V0UG9zWCgpO1xuICAgICAgICAgICAgY29uc3QgYnJpY2tSaWdodCAgPSBicmljay5nZXRQb3NYKCkgKyBicmljay5nZXRXaWR0aCgpO1xuICAgICAgICAgICAgY29uc3QgYnJpY2tCb3R0b20gPSBicmljay5nZXRQb3NZKCkgKyBicmljay5nZXRIZWlnaHQoKTtcbiAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBiYWxsQm90dG9uID0gdGhpcy55ICsgdGhpcy5yO1xuICAgICAgICAgICAgY29uc3QgYmFsbFRvcCA9IHRoaXMueSAtIHRoaXMucjtcbiAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4gKHRoaXMueCArIHRoaXMucikgPiBicmlja0xlZnRcbiAgICAgICAgICAgICAgICAmJiAodGhpcy54IC0gdGhpcy5yKSA8IGJyaWNrUmlnaHRcbiAgICAgICAgICAgICAgICAmJiBiYWxsQm90dG9uID4gYnJpY2tUb3BcbiAgICAgICAgICAgICAgICAmJiBiYWxsVG9wIDw9IGJyaWNrQm90dG9tXG4gICAgICAgICAgICAgICAgJiYgdGhpcy5keCA8IDA7ICAgICAgICAgICAgIC8vIGJhbGwgaXMgZ29pbmcgbGVmdFxuICAgIH1cbn1cbiIsImV4cG9ydCBjbGFzcyBDYW52YXMge1xuXG4gICAgcHJpdmF0ZSBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50O1xuICAgIHByaXZhdGUgY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XG5cbiAgICBpbml0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLmNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIFxuICAgICAgICAgICAgJ2NhbnZhcydcbiAgICAgICAgKTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChcbiAgICAgICAgICAgIHRoaXMuY2FudmFzXG4gICAgICAgICk7XG5cbiAgICAgICAgdGhpcy5jYW52YXNcbiAgICAgICAgICAgIC5zdHlsZVxuICAgICAgICAgICAgLmJhY2tncm91bmRDb2xvciA9ICcjZjBkYjRmJztcblxuICAgICAgICB0aGlzLmN0eCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoIFxuICAgICAgICAgICAgJzJkJyBcbiAgICAgICAgKTtcblxuICAgICAgICB0aGlzLnJlc2l6ZSgpO1xuICAgIH1cblxuICAgIGNsZWFyKCBcbiAgICAgICAgY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgKSAge1xuXG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSB0aGlzLmNhbnZhcy5zdHlsZS5iYWNrZ3JvdW5kQ29sb3I7XG4gICAgICAgIGN0eC5maWxsUmVjdCggXG4gICAgICAgICAgICAwLCBcbiAgICAgICAgICAgIDAsIFxuICAgICAgICAgICAgdGhpcy5jYW52YXMud2lkdGgsIFxuICAgICAgICAgICAgdGhpcy5jYW52YXMuaGVpZ2h0IFxuICAgICAgICApO1xuICAgIH07XG5cbiAgICBnZXQgY29udGV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3R4O1xuICAgIH1cblxuICAgIGdldCB3aWR0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FudmFzLndpZHRoO1xuICAgIH1cblxuICAgIGdldCBoZWlnaHQoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FudmFzLmhlaWdodDtcbiAgICB9XG5cbiAgICByZXNpemUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY2FudmFzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICB9XG59XG4iLCJleHBvcnQgY2xhc3MgUGFkZGxlIHtcbiAgICBwcml2YXRlIHc6IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSBoOiBudW1iZXIgPSAwO1xuICAgIHByaXZhdGUgeDogbnVtYmVyID0gMDtcbiAgICBwcml2YXRlIHk6IG51bWJlciA9IDA7XG4gICAgXG4gICAgcHJpdmF0ZSBjb2xvciA9ICdncmVlbic7XG5cbiAgICBpbml0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLnJlc2l6ZSgpO1xuICAgIH1cblxuICAgIHJlc2l6ZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy53ID0gd2luZG93LmlubmVyV2lkdGggLyA4O1xuICAgICAgICB0aGlzLmggPSB0aGlzLncgLyA1O1xuXG4gICAgICAgIHRoaXMueCA9ICh3aW5kb3cuaW5uZXJXaWR0aCAtIHRoaXMudykgLyAyO1xuICAgICAgICB0aGlzLnkgPSAod2luZG93LmlubmVySGVpZ2h0IC0gdGhpcy5oKTtcbiAgICB9O1xuXG4gICAgY2hlY2tCb3VuZHMoXG4gICAgICAgIG1heDogbnVtYmVyICk6IHZvaWQge1xuXG4gICAgICAgIGNvbnN0IGxlZnQgPSAgIHRoaXMueDtcbiAgICAgICAgY29uc3QgcmlnaHQgPSAgdGhpcy54ICsgdGhpcy53O1xuXG4gICAgICAgIGlmICggbGVmdCA8PSAwICkgICAgICAgICAgICAgdGhpcy54ID0gMDtcbiAgICAgICAgaWYgKCByaWdodCA+PSBtYXggKSB0aGlzLnggPSBtYXggLSB0aGlzLnc7XG4gICAgfTtcblxuICAgIG1vdmUoIFxuICAgICAgICBkeDogbnVtYmVyLFxuICAgICAgICBtYXg6IG51bWJlciApOiB2b2lkIHtcblxuICAgICAgICB0aGlzLnggKz0gZHg7XG4gICAgICAgIHRoaXMuY2hlY2tCb3VuZHMoXG4gICAgICAgICAgICBtYXhcbiAgICAgICAgKTtcbiAgICB9O1xuXG4gICAgcGFpbnQoIFxuICAgICAgICBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCApOiB2b2lkIHtcbiAgICAgICAgXG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSB0aGlzLmNvbG9yO1xuICAgICAgICBjdHguZmlsbFJlY3QoIHRoaXMueCwgdGhpcy55LCB0aGlzLncsIHRoaXMuaCApO1xuICAgIH07XG5cbiAgICBnZXRXaWR0aCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy53O1xuICAgIH1cbiAgICBnZXRIZWlnaHQoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaDtcbiAgICB9XG5cbiAgICBnZXRQb3NYKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLng7XG4gICAgfVxuXG4gICAgZ2V0UG9zWSgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy55O1xuICAgIH1cbn1cbiIsImV4cG9ydCBjbGFzcyBQbGF5ZXIge1xuXG4gICAgcHJpdmF0ZSBuYW1lOiBzdHJpbmcgPSAnSnVnYWRvcic7XG4gICAgcHJpdmF0ZSBwb2ludHM6IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSBsaXZlczogbnVtYmVyID0gMztcbiAgICBcbiAgICBpbml0KCk6IHZvaWQge1xuICAgICAgICBjb25zdCB1c2VyTmFtZTogc3RyaW5nID0gd2luZG93LnByb21wdChcbiAgICAgICAgICAgICdJbmdyZXNhIHR1IG5vbWJyZTonLCBcbiAgICAgICAgICAgIHRoaXMubmFtZVxuICAgICAgICApO1xuXG4gICAgICAgIGlmICggdXNlck5hbWUgIT0gbnVsbCAmJiB1c2VyTmFtZS5sZW5ndGggPiAwICkge1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gdXNlck5hbWU7XG4gICAgICAgIH1cblxuICAgICAgICBkb2N1bWVudC50aXRsZSA9IHRoaXMubmFtZTtcbiAgICB9XG5cbiAgICBpbmNQb2ludHMoIFxuICAgICAgICBpbmM6IG51bWJlciApOiB2b2lkIHtcbiAgICAgICAgICAgIFxuICAgICAgICB0aGlzLnBvaW50cyArPSBpbmM7XG4gICAgfVxuXG4gICAgZ2V0UG9pbnRzKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnBvaW50cztcbiAgICB9XG5cbiAgICBkZWNMaXZlcygpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5saXZlcy0tO1xuICAgIH1cblxuICAgIG51bUxpdmVzKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLmxpdmVzO1xuICAgIH1cblxuICAgIGdldE5hbWUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubmFtZTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBXYWxsIH0gZnJvbSAnLi93YWxsJztcblxuZXhwb3J0IGNsYXNzIEJyaWNrIHtcblxuICAgIHByaXZhdGUgd2lkdGg6IG51bWJlcjtcbiAgICBwcml2YXRlIGhlaWdodDogbnVtYmVyO1xuICAgIFxuICAgIHByaXZhdGUgY29sb3I6IHN0cmluZyA9ICdvcmFuZ2VyZWQnO1xuICAgIHByaXZhdGUgX3Zpc2libGU6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgcm93OiBudW1iZXIsXG4gICAgICAgIHByaXZhdGUgY29sOiBudW1iZXIgKSB7XG4gICAgfVxuXG4gICAgcmVzaXplKCk6IHZvaWQge1xuICAgICAgICB0aGlzLndpZHRoID0gKHdpbmRvdy5pbm5lcldpZHRoIFxuICAgICAgICAgICAgLSAoV2FsbC5CUklDS1NfUEVSX1JPVyAtIDEpICogV2FsbC5HQVApIC8gV2FsbC5CUklDS1NfUEVSX1JPVztcbiAgICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLndpZHRoIC8gNDsgICAgXG4gICAgfVxuXG4gICAgcGFpbnQoIFxuICAgICAgICBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCApOiB2b2lkIHtcbiAgICAgXG4gICAgICAgIGlmICggdGhpcy52aXNpYmxlICkge1xuICAgICAgICAgICAgY29uc3QgeCA9IHRoaXMuY29sICogKHRoaXMud2lkdGggKyBXYWxsLkdBUCk7XG4gICAgICAgICAgICBjb25zdCB5ID0gdGhpcy5yb3cgKiAodGhpcy5oZWlnaHQgKyBXYWxsLkdBUCk7XG5cbiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSB0aGlzLmNvbG9yO1xuICAgICAgICAgICAgY3R4LmZpbGxSZWN0KCB4LCB5LCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gTk9PUFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0V2lkdGgoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2lkdGg7XG4gICAgfVxuXG4gICAgZ2V0SGVpZ2h0KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLmhlaWdodDtcbiAgICB9XG5cbiAgICBnZXRQb3NYKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbCAqICh0aGlzLndpZHRoICsgV2FsbC5HQVApO1xuICAgIH1cblxuICAgIGdldFBvc1koKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm93ICogKHRoaXMuaGVpZ2h0ICsgV2FsbC5HQVApO1xuICAgIH1cblxuICAgIGdldCB2aXNpYmxlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fdmlzaWJsZTtcbiAgICB9XG5cbiAgICBzZXQgdmlzaWJsZSggXG4gICAgICAgIHY6IGJvb2xlYW4gKSB7XG4gICAgICAgIFxuICAgICAgICB0aGlzLl92aXNpYmxlID0gdjtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBCYWxsIH0gZnJvbSAnLi9iYWxsJztcbmltcG9ydCB7IEJyaWNrIH0gZnJvbSAnLi9icmljayc7XG5cbmV4cG9ydCBjbGFzcyBXYWxsIHtcbiAgICBzdGF0aWMgcmVhZG9ubHkgQlJJQ0tTX1BFUl9ST1c6IG51bWJlciA9IDU7XG4gICAgc3RhdGljIHJlYWRvbmx5IE5VTV9ST1dTOiBudW1iZXIgPSAzO1xuICAgIHN0YXRpYyByZWFkb25seSBHQVA6IG51bWJlciA9IDU7XG4gICAgXG4gICAgcHJpdmF0ZSBicmlja3M6IEJyaWNrW107XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5icmlja3MgPSBbXTtcbiAgICB9XG5cbiAgICBpbml0KCk6IHZvaWQge1xuICAgICAgICBmb3IgKCBsZXQgcm93OiBudW1iZXIgPSAwOyByb3cgPCBXYWxsLk5VTV9ST1dTOyByb3crKyApIHtcbiAgICAgICAgICAgIGZvciAoIGxldCBjb2w6IG51bWJlciA9IDA7IGNvbCA8IFdhbGwuQlJJQ0tTX1BFUl9ST1c7IGNvbCsrICkge1xuICAgICAgICAgICAgICAgIHRoaXMuYnJpY2tzLnB1c2goIFxuICAgICAgICAgICAgICAgICAgICBuZXcgQnJpY2soIHJvdywgY29sIClcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gaW5pdGlhbCByZXNpemVcbiAgICAgICAgdGhpcy5yZXNpemUoKTtcbiAgICB9XG4gICAgcHVibGljIGdldEJyaWNrcygpOiBCcmlja1tdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnJpY2tzO1xuICAgIH1cblxuICAgIHBhaW50KCBcbiAgICAgICAgY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgKTogdm9pZCB7XG4gICAgICAgIFxuICAgICAgICB0aGlzLmJyaWNrc1xuICAgICAgICAgICAgLmZvckVhY2goIChicmljaykgPT4gYnJpY2sucGFpbnQoIGN0eCApICk7IFxuICAgIH07XG5cbiAgICByZXNpemUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuYnJpY2tzXG4gICAgICAgICAgICAuZm9yRWFjaCggKGJyaWNrKSA9PiBicmljay5yZXNpemUoKSApO1xuICAgIH1cblxuICAgIGRldGVjdEJhbGxDb2xsaXNpb24oIFxuICAgICAgICBiYWxsOiBCYWxsICk6IG51bWJlciB7XG4gICAgICAgIFxuICAgICAgICBsZXQgYnJpY2tzRG93biA9IDA7XG4gICAgICAgIFxuICAgICAgICB0aGlzLmJyaWNrcy5mb3JFYWNoKCAoYnJpY2spID0+IHtcbiAgICAgICAgICAgIGlmICggYnJpY2sudmlzaWJsZSApIHtcbiAgICAgICAgICAgICAgICBpZiAoIGJhbGwuaGl0c0JyaWNrKCBicmljayApICkge1xuICAgICAgICAgICAgICAgICAgICBicmljay52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGJyaWNrc0Rvd24rKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBza2lwIGl0XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGJyaWNrc0Rvd247XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgQmFsbCB9IGZyb20gJy4vYmFsbCc7XG5pbXBvcnQgeyBDYW52YXMgfSBmcm9tICcuL2NhbnZhcyc7XG5pbXBvcnQgeyBQYWRkbGUgfSBmcm9tICcuL3BhZGRsZSc7XG5pbXBvcnQgeyBQbGF5ZXIgfSBmcm9tICcuL3BsYXllcic7XG5pbXBvcnQgeyBXYWxsIH0gZnJvbSAnLi93YWxsJztcblxuLy8gSW1tdXRhYmxlIENsYXNzXG5leHBvcnQgY2xhc3MgR2FtZSB7XG5cbiAgICBwcml2YXRlIGNhbnZhczogQ2FudmFzO1xuICAgIHByaXZhdGUgd2FsbDogICBXYWxsO1xuICAgIHByaXZhdGUgYmFsbDogICBCYWxsO1xuICAgIHByaXZhdGUgcGFkZGxlOiBQYWRkbGU7XG4gICAgcHJpdmF0ZSBwbGF5ZXI6IFBsYXllcjtcbiAgICBcbiAgICBwcml2YXRlIHBhdXNlZDogYm9vbGVhbjtcblxuICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IGluc3RhbmNlOiBHYW1lID0gbmV3IEdhbWUoXG4gICAgICAgICcxLjEnXG4gICAgKTtcblxuICAgIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBHYW1lIHtcbiAgICAgICAgcmV0dXJuIEdhbWUuaW5zdGFuY2U7XG4gICAgfSBcblxuICAgIHByaXZhdGUgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgX3ZlcnNpb246IHN0cmluZyApIHtcblxuICAgICAgICB0aGlzLmNhbnZhcyA9IG5ldyBDYW52YXMoKTtcbiAgICAgICAgdGhpcy53YWxsICAgPSBuZXcgV2FsbCgpO1xuICAgICAgICB0aGlzLmJhbGwgICA9IG5ldyBCYWxsKCk7XG4gICAgICAgIHRoaXMucGFkZGxlID0gbmV3IFBhZGRsZSgpO1xuICAgICAgICB0aGlzLnBsYXllciA9IG5ldyBQbGF5ZXIoKTtcbiAgICB9XG5cbiAgICBpbml0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLmNhbnZhcy5pbml0KCk7XG4gICAgICAgIHRoaXMud2FsbC5pbml0KCk7XG4gICAgICAgIHRoaXMucGFkZGxlLmluaXQoKTtcbiAgICAgICAgdGhpcy5iYWxsLmluaXQodGhpcy5wYWRkbGUpO1xuICAgICAgICB0aGlzLnBsYXllci5pbml0KCk7XG5cbiAgICAgICAgd2luZG93Lm9ucmVzaXplID0gdGhpcy5yZXNpemVcbiAgICAgICAgICAgIC5iaW5kKFxuICAgICAgICAgICAgICAgIHRoaXNcbiAgICAgICAgICAgICk7XG4gICAgXG4gICAgICAgIHdpbmRvdy5vbmtleWRvd24gPSB0aGlzLmtleWRvd25cbiAgICAgICAgICAgIC5iaW5kKFxuICAgICAgICAgICAgICAgIHRoaXNcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgLy8gaW5pdGlhbCBwYWludFxuICAgICAgICB0aGlzLnBhaW50KCk7XG4gICAgfVxuICAgIFxuICAgIHBhaW50KCk6IHZvaWQge1xuICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIGlmICggdGhpcy5wbGF5ZXIubnVtTGl2ZXMoKSA9PSAwICkge1xuICAgICAgICAgICAgZG9jdW1lbnQudGl0bGUgPSAnR0FNRSBPVkVSIFsnXG4gICAgICAgICAgICAgICAgKyB0aGlzLnBsYXllci5nZXRQb2ludHMoKVxuICAgICAgICAgICAgICAgICsgJyBQT0lOVFNdJztcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIHRoaXMucGxheWVyLmdldFBvaW50cygpID09IHRoaXMud2FsbC5nZXRCcmlja3MoKS5sZW5ndGggKSB7XG4gICAgICAgICAgICBkb2N1bWVudC50aXRsZSA9ICcgWU9VIFdJTiBbJ1xuICAgICAgICAgICAgICAgICsgdGhpcy5wbGF5ZXIuZ2V0UG9pbnRzKClcbiAgICAgICAgICAgICAgICArICcgUE9JTlRTXSc7XG4gICAgICAgICAgICB3aW5kb3cuYWxlcnQoJ1lPVSBXSU4hJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIHRoaXMucGF1c2VkICkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY3R4ID0gdGhpcy5jYW52YXMuY29udGV4dDsgXG4gICAgICAgIGlmICggY3R4ICkgeyBcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLmNsZWFyKCBjdHggKTtcbiAgICAgICAgICAgIHRoaXMud2FsbC5wYWludCggY3R4ICk7XG4gICAgICAgICAgICB0aGlzLnBhZGRsZS5wYWludCggY3R4ICk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICggdGhpcy5iYWxsLnBhaW50KCB0aGlzLmNhbnZhcyApICkgeyAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHRoaXMuZGV0ZWN0Q29sbGlzaW9ucygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIuZGVjTGl2ZXMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmJhbGwuaW5pdCh0aGlzLnBhZGRsZSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnBhdXNlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5wYWludC5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgdmVyc2lvbigpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5fdmVyc2lvbjtcbiAgICB9XG5cbiAgICAvLyBwcml2YXRlIG1ldGhvZHMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICBwcml2YXRlIHJlc2l6ZSgpOiB2b2lkIHsgXG4gICAgICAgIHRoaXMuY2FudmFzLnJlc2l6ZSgpO1xuICAgICAgICB0aGlzLndhbGwucmVzaXplKCk7XG4gICAgICAgIHRoaXMuYmFsbC5yZXNpemUoKTtcbiAgICAgICAgdGhpcy5wYWRkbGUucmVzaXplKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkZXRlY3RCYWxsV2FsbENvbGxpc2lvbigpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgYnJpY2tzSGl0ID0gdGhpcy53YWxsXG4gICAgICAgICAgICAuZGV0ZWN0QmFsbENvbGxpc2lvbiggXG4gICAgICAgICAgICAgICAgdGhpcy5iYWxsIFxuICAgICAgICAgICAgKTtcblxuICAgICAgICB0aGlzLnBsYXllclxuICAgICAgICAgICAgLmluY1BvaW50cyhcbiAgICAgICAgICAgICAgICBicmlja3NIaXRcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgZG9jdW1lbnQudGl0bGUgPSB0aGlzLnBsYXllci5nZXROYW1lKCkgXG4gICAgICAgICAgICArICcgWydcbiAgICAgICAgICAgICsgdGhpcy5wbGF5ZXIuZ2V0UG9pbnRzKClcbiAgICAgICAgICAgICsgJyBQT0lOVFNdJztcbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSBkZXRlY3RDb2xsaXNpb25zKCk6IHZvaWQge1xuICAgICAgICBpZiAoIHRoaXMuYmFsbC5kZXRlY3RQYWRkbGVDb2xsaXNpb24oIFxuICAgICAgICAgICAgdGhpcy5wYWRkbGUgKSApIHtcblxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICB0aGlzLmRldGVjdEJhbGxXYWxsQ29sbGlzaW9uKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBrZXlkb3duKCBcbiAgICAgICAgZTogS2V5Ym9hcmRFdmVudCApOiB2b2lkIHtcblxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7ICAgICAgICAgLy8gZG8gbm90IGJ1YmJsZVxuXG4gICAgICAgIGlmICggZS5jb2RlID09ICdTcGFjZScgKSB7XG4gICAgICAgICAgICB0aGlzLnBhdXNlZCA9ICF0aGlzLnBhdXNlZDtcblxuICAgICAgICAgICAgaWYgKCAhdGhpcy5wYXVzZWQgKSB7XG4gICAgICAgICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWludFxuICAgICAgICAgICAgICAgICAgICAgICAgLmJpbmQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1xuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIGUuY29kZSA9PSAnQXJyb3dMZWZ0JyApIHtcbiAgICAgICAgICAgIHRoaXMucGFkZGxlXG4gICAgICAgICAgICAgICAgLm1vdmUoIFxuICAgICAgICAgICAgICAgICAgICAtNDAsIFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbnZhcy53aWR0aCBcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCBlLmNvZGUgPT0gJ0Fycm93UmlnaHQnICkge1xuICAgICAgICAgICAgdGhpcy5wYWRkbGVcbiAgICAgICAgICAgICAgICAubW92ZSggXG4gICAgICAgICAgICAgICAgICAgICs0MCwgXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2FudmFzLndpZHRoXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH07XG59XG4iLCJpbXBvcnQgeyBHYW1lIH0gZnJvbSAnLi9nYW1lJztcblxuLy8gc3RhcnQgdGhlIGdhbWVcbkdhbWUuZ2V0SW5zdGFuY2UoKVxuICAgIC5pbml0KCk7XG4iXSwibmFtZXMiOlsieCIsInkiLCJkeCIsImR5IiwiciIsImNvbG9yIiwiaW5pdCIsInBhZGRsZSIsInRoaXMiLCJyZXNpemUiLCJ3aW5kb3ciLCJpbm5lcldpZHRoIiwiaW5uZXJIZWlnaHQiLCJjaGVja0JvdW5kcyIsImNhbnZhcyIsImxlZnQiLCJyaWdodCIsInRvcCIsImJvdHRvbSIsIndpZHRoIiwiaGVpZ2h0IiwicGFpbnQiLCJjdHgiLCJjb250ZXh0IiwiZmlsbFN0eWxlIiwiYmVnaW5QYXRoIiwiYXJjIiwiTWF0aCIsIlBJIiwiZmlsbCIsImNsb3NlUGF0aCIsIm1vdmUiLCJpbnZlcnREZWx0YVkiLCJpbnZlcnREZWx0YVgiLCJkZXRlY3RQYWRkbGVDb2xsaXNpb24iLCJiYWxsTGVmdCIsImJhbGxSaWdodCIsImJhbGxCb3R0b20iLCJwYWRkbGVMZWZ0IiwiZ2V0UG9zWCIsInBhZGRsZVJpZ2h0IiwiZ2V0V2lkdGgiLCJwYWRkbGVUb3AiLCJnZXRQb3NZIiwiY29sbGlzaW9uIiwiZ2V0SGVpZ2h0IiwiY29uc29sZSIsImxvZyIsInB1bnRvR29scGVFblBhZGRsZSIsImFuZ3VsbyIsInNpbiIsImNvcyIsImhpdHNCcmljayIsImJyaWNrIiwiYm90dG9tQnJpY2tDb2xsaXNpb24iLCJ0b3BCcmlja0NvbGxpc2lvbiIsImxlZnRCcmlja0NvbGxpc2lvbiIsInJpZ2h0QnJpY2tDb2xsaXNpb24iLCJicmlja0JvdHRvbSIsImJyaWNrTGVmdCIsImJyaWNrUmlnaHQiLCJiYWxsVG9wIiwiYnJpY2tUb3AiLCJiYWxsQm90dG9uIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiYm9keSIsImFwcGVuZENoaWxkIiwic3R5bGUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJnZXRDb250ZXh0IiwiY2xlYXIiLCJmaWxsUmVjdCIsInciLCJoIiwibWF4IiwibmFtZSIsInBvaW50cyIsImxpdmVzIiwidXNlck5hbWUiLCJwcm9tcHQiLCJsZW5ndGgiLCJ0aXRsZSIsImluY1BvaW50cyIsImluYyIsImdldFBvaW50cyIsImRlY0xpdmVzIiwibnVtTGl2ZXMiLCJnZXROYW1lIiwicm93IiwiY29sIiwiX3Zpc2libGUiLCJXYWxsIiwiQlJJQ0tTX1BFUl9ST1ciLCJHQVAiLCJ2aXNpYmxlIiwidiIsImJyaWNrcyIsIk5VTV9ST1dTIiwicHVzaCIsIkJyaWNrIiwiZ2V0QnJpY2tzIiwiZm9yRWFjaCIsImRldGVjdEJhbGxDb2xsaXNpb24iLCJiYWxsIiwiYnJpY2tzRG93biIsIl92ZXJzaW9uIiwiQ2FudmFzIiwid2FsbCIsIkJhbGwiLCJQYWRkbGUiLCJwbGF5ZXIiLCJQbGF5ZXIiLCJnZXRJbnN0YW5jZSIsIkdhbWUiLCJpbnN0YW5jZSIsIm9ucmVzaXplIiwiYmluZCIsIm9ua2V5ZG93biIsImtleWRvd24iLCJhbGVydCIsInBhdXNlZCIsImRldGVjdENvbGxpc2lvbnMiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJkZXRlY3RCYWxsV2FsbENvbGxpc2lvbiIsImJyaWNrc0hpdCIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImNvZGUiXSwic291cmNlUm9vdCI6IiJ9